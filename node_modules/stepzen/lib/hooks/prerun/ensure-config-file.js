"use strict";
// Copyright (c) 2020,2021,2022, StepZen, Inc.
Object.defineProperty(exports, "__esModule", { value: true });
const path = require("path");
const debug = require("debug");
const configuration_1 = require("../../shared/configuration");
const constants_1 = require("../../shared/constants");
const hook = async function () {
    // If the configuration is set through an env variable,
    // skip all the config file checks.
    if (process.env.STEPZEN_CONFIG_CONTENT) {
        return;
    }
    const configFilePath = path.join(constants_1.STEPZEN_CONFIG_DIRECTORY, constants_1.STEPZEN_CONFIG_FILE);
    let rawConfiguration;
    try {
        rawConfiguration = await configuration_1.importConfiguration(configFilePath);
    }
    catch (_a) {
        rawConfiguration = null;
    }
    const { configuration, modified } = await configuration_1.ensureValidConfiguration(rawConfiguration);
    if (modified) {
        configuration_1.writeConfiguration(configuration);
        debug('stepzen:configuration')(`Automatically updated the ${configFilePath} config file.`);
    }
};
exports.default = hook;
